<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/qualifiedForCreditForElderlyAndDisabled">
      <Description>Whether the TP(s) are qualified for the credit for the elderly or the disabled (Schedule R)</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <All>
          <Dependency path="/hasTaxLiabilityForEdc" />
          <Dependency path="/maybeEligibleForCreditForElderlyAndDisabled" />
          <Dependency path="/isQualifiedForEdcBasedOnAgeOrDisability" />
          <Dependency path="/isQualifiedForEdcBasedOnAgiLimit" />
          <Dependency path="/isQualifiedForEdcBasedOnNonTaxablePayments" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForCreditForElderlyAndDisabled">
      <Description>Whether the TP(s) are potentially eligible for the credit for the elderly or the disabled (Schedule
        R)</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <All>
          <Dependency module="schedule3" path="/hasTaxLiabilityAfterCdcc" />
          <Dependency path="/maybeEligibleForCreditForElderlyAndDisabledWoTaxLiability" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForCreditForElderlyAndDisabledWoTaxLiability">
      <Description>Whether the TP(s) might be eligible for the credit for the elderly or the disabled (Schedule
        R),
        without considering whether they have tax liability against which the credit could be applied.</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <All>
          <Dependency path="/isEligibleForEdcBasedOnAgeOrDisability" />
          <Dependency path="/maybeEligibleForEdcBasedOnRelaxedAgiLimit" />
          <Dependency path="/isMaybeEligibleForEdcBasedOnNonTaxablePayments" />
          <Any>
            <Not>
              <Dependency module="filingStatus" path="/isFilingStatusMFS" />
            </Not>
            <All>
              <Dependency module="filingStatus" path="/isFilingStatusMFS" />
              <Dependency module="filers" path="/livedApartAllYear" />
            </All>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEdcSectionComplete">
      <Description>Whether the EDC section is considered complete</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <Any>
          <!-- Not eligible or not qualified -->
          <Not>
            <Dependency path="/maybeEligibleForCreditForElderlyAndDisabled" />
          </Not>
          <Not>
            <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
          </Not>

          <!-- Is qualified -->
          <Any>
            <!-- Qualified through elderly -->
            <All>
              <Not>
                <Dependency path="/atLeastOneFilerQualifiedForEdcThroughDisability" />
              </Not>
              <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
            </All>

            <!-- qualified through disabled (and needs to answer associated questions) -->
            <All>
              <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
              <Dependency path="/atLeastOneFilerQualifiedForEdcThroughDisability" />
              <Dependency path="/filersCompletedEdcPhysicianStatementQuestions" />
              <Dependency path="/isInitialDisabilitySectionComplete" />
            </All>
          </Any>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/edcMaxSingleHohQssAgiLimit">
      <Description>Max AGI Limit to be qualified for EDC (elderly or disabled credit) as single, HoH, QSS filing
        statuses</Description>
      <Derived>
        <Dollar>17500</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfsAgiLimit">
      <Description>Max AGI Limit to be qualified for EDC as MFS filing status</Description>
      <Derived>
        <Dollar>12500</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfjBothAgiLimit">
      <Description>Max AGI Limit to be qualified for EDC as MFJ filing status when both filers qualify</Description>
      <Derived>
        <Dollar>25000</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfjOnlyOneAgiLimit">
      <Description>Max AGI Limit to be qualified for EDC as MFJ filing status when only one filer qualifies</Description>
      <Derived>
        <Dollar>20000</Dollar>
      </Derived>
    </Fact>

    <Fact path="/filers/*/arePaymentsTaxDisabilityIncome">
      <Description>Were any payments on W2 disability income from accident or health plan or pension
        plan paid by an
        employer</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/isRetOnPermOrTotalDisability">
      <Description>Is TP retired or permanent and total disability by the end of TY</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/employerHasMandatoryRetirementAge">
      <Description>Whether the employer has a mandatory retirement age</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/hasMetEmployerMandatoryRetirementAge">
      <Description>Whether the tp reached employer's mandatory retirement age by January 1</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/writableTotalTaxableDisabilityAmount">
      <Description>(Writable)The total amount of taxable disability income from accident or health plan or pension plan
        paid by an employer</Description>

      <Writable>
        <Dollar />
        <Limit type="Min">
          <Dollar>0</Dollar>
        </Limit>
      </Writable>
    </Fact>

    <Fact path="/filers/*/totalTaxableDisabilityAmount">
      <Description>The total amount of taxable disability income from accident or health plan or pension plan paid by an
        employer.</Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <All>
                <Dependency path="../hasTaxableDisabilityPaymentsAndRetOnDisability" />
                <IsComplete>
                  <Dependency path="../writableTotalTaxableDisabilityAmount" />
                </IsComplete>
              </All>
            </When>
            <Then>
              <Dependency path="../writableTotalTaxableDisabilityAmount" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/filers/*/employerHasMandatoryRetirementAgeAndRetired">
      <Description>Whether the employer has a mandatory retirement age</Description>
      <Derived>
        <All>
          <Dependency path="../isRetOnPermOrTotalDisability" />
          <Dependency path="../employerHasMandatoryRetirementAge" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/hasPhysicianStatementBothDisabledAndWillNotImprove">
      <Description>In a previous year, has the TP, received a physician's statement certifying both permanent/total
        disability AND no reasonable probability to ever improve</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/hasPhysicianStatementBefore1983">
      <Description>Did the TP file a physicians statement for 1983 or earlier regarding permanent/total disability</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/askAboutPhysicianStatementSelfCertify">
      <Description>Whether the TP should be asked about the self certification of their physician's statement</Description>
      <Derived>
        <Any>
          <Dependency path="../hasPhysicianStatementBothDisabledAndWillNotImprove" />
          <All>
            <Not>
              <Dependency path="../hasPhysicianStatementBothDisabledAndWillNotImprove" />
            </Not>
            <Dependency path="../hasPhysicianStatementBefore1983" />
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/filers/*/physicianStatementNeeded">
      <Description>Whether the TP needs a physician's statement</Description>
      <Derived>
        <Any>
          <All>
            <Dependency path="../askAboutPhysicianStatementSelfCertify" />
            <Not>
              <Dependency path="../hasSelfCertPhysStatmntOrVetDisbltyVerified" />
            </Not>
          </All>
          <All>
            <Not>
              <Dependency path="../hasPhysicianStatementBothDisabledAndWillNotImprove" />
            </Not>
            <Not>
              <Dependency path="../hasPhysicianStatementBefore1983" />
            </Not>
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/filers/*/hasSelfCertPhysStatmntOrVetDisbltyVerified">
      <Description>Did the TP self-certify that due to their disability, they are not able to engage in gainful activity</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/physicianStatementNotNeeded">
      <Description>Whether the TP does not need another physician's statement</Description>
      <Derived>
        <All>
          <Dependency path="../askAboutPhysicianStatementSelfCertify" />
          <Dependency path="../hasSelfCertPhysStatmntOrVetDisbltyVerified" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/determinedIfEdcPhysicianStatementIsNeededOrNot">
      <Description>Have we collected enough information to determine if a physician's statement is needed or not</Description>
      <Derived>
        <Any>
          <Not>
            <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
          </Not>
          <All>
            <Dependency path="../isMaybeQualifiedforEdcThroughDisability" />
            <Any>
              <Dependency path="../physicianStatementNeeded" />
              <Dependency path="../physicianStatementNotNeeded" />
            </Any>
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/allDisabledEdcQualifiedDontNeedPhysicianStatement">
      <Description>Whether all of the disabled qualified TPs don't need a physician's statement</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency path="/filersCompletedEdcPhysicianStatementQuestions" />
          <Equal>
            <Left>
              <CollectionSize>
                <Dependency path="/filersQualifiedForEdcThroughDisability" />
              </CollectionSize>
            </Left>
            <Right>
              <CollectionSize>
                <Filter path="/filersQualifiedForEdcThroughDisability">
                  <Dependency path="physicianStatementNotNeeded" />
                </Filter>
              </CollectionSize>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filersCompletedEdcPhysicianStatementQuestions">
      <Description>Whether filer(s) have completed the physician's statement section if needed</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <All>
                <Dependency path="/primaryFiler/hasCompletedPhysicianStatementQuestions" />
                <Dependency path="/secondaryFiler/hasCompletedPhysicianStatementQuestions" />
              </All>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/primaryFiler/hasCompletedPhysicianStatementQuestions" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/filers/*/hasCompletedPhysicianStatementQuestions">
      <Description>Whether the TP has completed the physician's statement questions</Description>
      <Derived>
        <All>
          <IsComplete>
            <Dependency path="../determinedIfEdcPhysicianStatementIsNeededOrNot" />
          </IsComplete>
          <Dependency path="../determinedIfEdcPhysicianStatementIsNeededOrNot" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/hasDisabilityIncome">
      <Description> Whether the TP has disability income to report</Description>
      <Derived>
        <All>
          <Dependency path="../maybeEligibleForDisabilityCredit" />
          <Dependency path="../isRetOnPermOrTotalDisability" />
          <Any>
            <Not>
              <Dependency path="../employerHasMandatoryRetirementAge" />
            </Not>
            <All>
              <Dependency path="../employerHasMandatoryRetirementAge" />
              <Not>
                <Dependency path="../hasMetEmployerMandatoryRetirementAge" />
              </Not>
            </All>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/hasTaxableDisabilityPaymentsAndRetOnDisability">
      <Description>Did tp have any nontaxable payments to report and are retired on disability</Description>
      <Derived>
        <All>
          <Dependency path="../hasDisabilityIncome" />
          <Dependency path="../arePaymentsTaxDisabilityIncome" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isMaybeQualifiedforEdcThroughDisability">
      <Description>Whether the TP is qualified based on disability</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <All>
                <Dependency module="filers" path="../isPrimaryFilerOrMfjAndEither" />
                <IsComplete>
                  <Dependency path="../hasTaxableDisabilityPaymentsAndRetOnDisability" />
                </IsComplete>
                <Dependency path="../hasTaxableDisabilityPaymentsAndRetOnDisability" />
              </All>
            </When>
            <Then>
              <NotEqual>
                <Left>
                  <Dependency path="../totalTaxableDisabilityAmount" />
                </Left>
                <Right>
                  <Dollar>0</Dollar>
                </Right>
              </NotEqual>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <False />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/mfjAndOnlyOneQualfiedForEdc">
      <Description>If the TP is MFJ and only one qualifies for EDC</Description>
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          <Dependency path="/isInitialDisabilitySectionComplete" />
          <Equal>
            <Left>
              <CollectionSize>
                <Filter path="/filers">
                  <Any>
                    <Dependency path="isMaybeQualifiedforEdcThroughDisability" />
                    <Dependency module="filers" path="age65OrOlder" />
                  </Any>
                </Filter>
              </CollectionSize>
            </Left>
            <Right>
              <Int>1</Int>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcAgiLimitBasedOnQualified">
      <Description>AGI limit to be eligible for EDC based on the number of TPs qualified, only applicable for MFJ</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/mfjAndOnlyOneQualfiedForEdc" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfjOnlyOneAgiLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="/isInitialDisabilitySectionComplete" />
            </When>
            <Then>
              <Dependency path="/edcRelaxedAgiLimit" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isQualifiedForEdcBasedOnAgiLimit">
      <Description>Whether the TP(s) are qualified based on AGI limit</Description>
      <Derived>
        <LessThan>
          <Left>
            <Dependency module="taxCalculations" path="/agi" />
          </Left>
          <Right>
            <Dependency path="/edcAgiLimitBasedOnQualified" />
          </Right>
        </LessThan>
      </Derived>
    </Fact>

    <Fact path="/edcRelaxedAgiLimit">
      <Description>The less restrictive AGI limit based on filing status, while we don't know if both spouses qualify</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfjBothAgiLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFS" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfsAgiLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/edcMaxSingleHohQssAgiLimit" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>


    <Fact path="/edcMaxSingleHohQssNontaxableLimit">
      <Description>Max nontaxable social security or other nontaxable pensions, annuities, or disability
        income to be
        qualified for EDC as single, HoH, QSS filing statuses</Description>
      <Derived>
        <Dollar>5000</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfsNontaxableLimit">
      <Description>Max nontaxable social security or other nontaxable pensions, annuities, or disability
        income to be
        qualified for EDC as MFS filing status</Description>
      <Derived>
        <Dollar>3750</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfjBothNontaxableLimit">
      <Description>Max nontaxable social security or other nontaxable pensions, annuities, or disability
        income to be
        qualified for EDC as MFJ filing status when both filers qualify</Description>
      <Derived>
        <Dollar>7500</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcMaxMfjOnlyOneNontaxableLimit">
      <Description>Max nontaxable social security or other nontaxable pensions, annuities, or disability
        income to be
        qualified for EDC as MFJ filing status when only one filer qualifies</Description>
      <!-- This is currently redudant as it has the same value as /maxSingleHohQssNontaxableLimit. It might make sense
      to combine them but not doing that in case they differ in the future -->
      <Derived>
        <Dollar>5000</Dollar>
      </Derived>
    </Fact>

    <Fact path="/edcRelaxedNontaxableLimit">
      <Description>The less restrictive nontaxable limit based on filing status, while we don't know if both spouses
        qualify</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfjBothNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFS" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfsNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/edcMaxSingleHohQssNontaxableLimit" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/edcNonTaxableLimitBasedOnQualified">
      <Description>The nontaxable limit based on the number of TPs qualified</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/mfjAndOnlyOneQualfiedForEdc" />
            </When>
            <Then>
              <Dependency path="/edcMaxMfjOnlyOneNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="/isInitialDisabilitySectionComplete" />
            </When>
            <Then>
              <Dependency path="/edcRelaxedNontaxableLimit" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEdcBasedOnRelaxedAgiLimit">
      <Description>Whether the taxpayer might eligible for EDC based on their filing status and the relaxed AGI limit.</Description>
      <Derived>
        <LessThan>
          <Left>
            <Dependency module="taxCalculations" path="/agi" />
          </Left>
          <Right>
            <Dependency path="/edcRelaxedAgiLimit" />
          </Right>
        </LessThan>
      </Derived>
    </Fact>

    <Fact path="/isQualifiedForEdcBasedOnNonTaxablePayments">
      <Description>Whether the TP passes the non taxable payments limit based on the number of people qualified</Description>
      <Derived>
        <All>
          <Dependency path="/hasEdcNetCreditAmount" />
          <LessThan>
            <Left>
              <Dependency path="/edcTotalNonTaxableAmount" />
            </Left>
            <Right>
              <Dependency path="/edcNonTaxableLimitBasedOnQualified" />
            </Right>
          </LessThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isMaybeEligibleForEdcBasedOnNonTaxablePayments">
      <Description>Whether the taxpayer is initially eligible for EDC based on whether they exceed the EDC limit for
        nontaxable payments.</Description>
      <Derived>
        <LessThan>
          <Left>
            <Dependency path="/edcInitialNonTaxableAmountForPotentialEligibility" />
          </Left>
          <Right>
            <Dependency path="/edcRelaxedNontaxableLimit" />
          </Right>
        </LessThan>
      </Derived>
    </Fact>

    <Fact path="/atLeastOneFilerQualifiedForEdcThroughDisability">
      <Description>If at least one filer is qualified for EDC based on disability rather than age</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <CollectionSize>
              <Dependency path="/filersQualifiedForEdcThroughDisability" />
            </CollectionSize>
          </Left>
          <Right>
            <Int>0</Int>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/isQualifiedForEdcBasedOnAgeOrDisability">
      <Description>Whether the taxpayer or their spouse is qualified for EDC based off their age or possible taxable
        disability income.</Description>
      <Derived>
        <Any>
          <Dependency path="/isEligibleForEdcBasedOnAge" />
          <Dependency path="/atLeastOneFilerQualifiedForEdcThroughDisability" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/tpCanBeAskedAboutNonTaxablePayments">
      <Description>Whether the TP is eligible to be asked about their nontaxable payments</Description>
      <Derived>
        <Any>
          <Dependency path="/isEligibleForEdcBasedOnAge" />
          <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
          <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
        </Any>
      </Derived>

    </Fact>

    <Fact path="/isEligibleForEdcBasedOnAge">
      <Derived>
        <Dependency module="filers" path="/atLeastOneTpIs65OrOlder" />
      </Derived>
    </Fact>

    <Fact path="/maybeEligibleForEdcBasedOnDisability">
      <Description>Whether anyone on the tax return is eligible for the EDC credit based on their disability
        information.</Description>
      <Derived>
        <All>
          <Dependency module="filers" path="/atLeastOneTpIsUnder65" />
          <Dependency path="/isMaybeEligibleForEdcBasedOnTaxableDisabilityIncome" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/isEligibleForEdcBasedOnAgeOrDisability">
      <Description>Whether the taxpayer is eligible based off their age or possible taxable disability income.</Description>
      <Derived>
        <Any>
          <Dependency path="/isEligibleForEdcBasedOnAge" />
          <Dependency path="/maybeEligibleForEdcBasedOnDisability" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/isMaybeEligibleForEdcBasedOnTaxableDisabilityIncome">
      <Description>Whether the taxpayer might initially be eligible for receiving EDC based on if they have received any
        income reported on a W-2</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency module="formW2s" path="/wages" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/edcLine1">
      <Description>Elderly or Disabled Credit (Schedule R) Line 1</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Any>
            <Dependency module="filingStatus" path="/isFilingStatusSingle" />
            <Dependency module="filingStatus" path="/isFilingStatusHOH" />
            <Dependency module="filingStatus" path="/isFilingStatusQSS" />
          </Any>
          <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcLine2">
      <Description>Elderly or Disabled Credit (Schedule R) Line 2</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Any>
            <Dependency module="filingStatus" path="/isFilingStatusSingle" />
            <Dependency module="filingStatus" path="/isFilingStatusHOH" />
            <Dependency module="filingStatus" path="/isFilingStatusQSS" />
          </Any>
          <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcLine3">
      <Description>Elderly or Disabled Credit (Schedule R) Line 3</Description>
      <Export mef="true" />
      <Derived>
        <Any>
          <All>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
            <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/edcLine4">
      <Description>Elderly or Disabled Credit (Schedule R) Line 4</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          <Not>
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
          </Not>
          <Not>
            <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
          </Not>
          <Equal>
            <Left>
              <CollectionSize>
                <Dependency path="/filersQualifiedForEdcThroughDisability" />
              </CollectionSize>
            </Left>
            <Right>
              <Int>1</Int>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcLine5">
      <Description>Elderly or Disabled Credit (Schedule R) Line 5</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          <Not>
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
          </Not>
          <Not>
            <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
          </Not>
          <Equal>
            <Left>
              <CollectionSize>
                <Dependency path="/filersQualifiedForEdcThroughDisability" />
              </CollectionSize>
            </Left>
            <Right>
              <Int>2</Int>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcLine6">
      <Description>Elderly or Disabled Credit (Schedule R) Line 6</Description>
      <Export mef="true" />
      <Derived>
        <Any>
          <!-- Primary is 65 or older while secondary is under 65 and retired on perm and total disability -->
          <All>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
            <Not>
              <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
            </Not>
            <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
          </All>
          <!-- Secondary is 65 or older while primary is under 65 and retired on perm and total disability -->
          <All>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
            <Not>
              <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
            </Not>
            <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/edcLine7">
      <Description>Elderly or Disabled Credit (Schedule R) Line 7</Description>
      <Export mef="true" />
      <Derived>
        <Any>
          <!-- Primary is 65 or older while secondary is under 65 and NOT retired on perm and total disability -->
          <All>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
            <Not>
              <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
            </Not>
            <Not>
              <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
            </Not>
          </All>
          <!-- Secondary is 65 or older while primary is under 65 and NOT retired on perm and total disability -->
          <All>
            <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            <Dependency module="filers" path="/secondaryFiler/age65OrOlder" />
            <Not>
              <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
            </Not>
            <Not>
              <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
            </Not>
          </All>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/edcLine8">
      <Description>Elderly or Disabled Credit (Schedule R) Line 8</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFS" />
          <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcLine9">
      <Description>Elderly or Disabled Credit (Schedule R) Line 9</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFS" />
          <Not>
            <Dependency module="filers" path="/primaryFiler/age65OrOlder" />
          </Not>
          <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcFilingStatusAmt">
      <Description>Elderly or Disabled Credit (Schedule R) Line 10, which is the filing status amount</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine1" />
                <Dependency path="/edcLine2" />
                <Dependency path="/edcLine4" />
                <Dependency path="/edcLine7" />
              </Any>
            </When>
            <Then>
              <Dependency path="/edcMaxMfjOnlyOneNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine3" />
                <Dependency path="/edcLine5" />
                <Dependency path="/edcLine6" />
              </Any>
            </When>
            <Then>
              <Dependency path="/edcMaxMfjBothNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine8" />
                <Dependency path="/edcLine9" />
              </Any>
            </When>
            <Then>
              <Dependency path="/edcMaxMfsNontaxableLimit" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/statusBasedDisabilityIncome">
      <Description>The modified taxable disability income for Schedule R, Line 11</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/edcLine6" />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
                  </When>
                  <Then>
                    <Add>
                      <Dependency path="/primaryFiler/totalTaxableDisabilityAmount" />
                      <Dollar>5000</Dollar>
                    </Add>
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
                  </When>
                  <Then>
                    <Add>
                      <Dependency path="/secondaryFiler/totalTaxableDisabilityAmount" />
                      <Dollar>5000</Dollar>
                    </Add>
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine2" />
                <Dependency path="/edcLine9" />
              </Any>
            </When>
            <Then>
              <Dependency path="/primaryFiler/totalTaxableDisabilityAmount" />
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="/edcLine4" />
            </When>
            <Then>
              <Switch>
                <Case>
                  <When>
                    <Dependency path="/primaryFiler/isMaybeQualifiedforEdcThroughDisability" />
                  </When>
                  <Then>
                    <Dependency path="/primaryFiler/totalTaxableDisabilityAmount" />
                  </Then>
                </Case>
                <Case>
                  <When>
                    <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
                  </When>
                  <Then>
                    <Dependency path="/secondaryFiler/totalTaxableDisabilityAmount" />
                  </Then>
                </Case>
              </Switch>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="/edcLine5" />
            </When>
            <Then>
              <Add>
                <Dependency path="/primaryFiler/totalTaxableDisabilityAmount" />
                <Dependency path="/secondaryFiler/totalTaxableDisabilityAmount" />
              </Add>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/lesserOfFilingStatusAmountAndTaxableDisabilityIncome">
      <Description>The lesser of Line 10 and Line 11 on Schedule R, used for Line 12 of Sch. R</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/atLeastOneFilerQualifiedForEdcThroughDisability" />
            </When>
            <Then>
              <LesserOf>
                <Dependency path="/edcFilingStatusAmt" />
                <Dependency path="/statusBasedDisabilityIncome" />
              </LesserOf>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/edcFilingStatusAmt" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/edcNonTaxableSocialSecurityAndRailroadBenefits">
      <Description>1040 Schedule R line 13a: Nontaxable social security and railroad benefits</Description>
      <Export mef="true" />

      <Derived>
        <Dependency module="socialSecurity" path="/nonTaxableSocialSecurityBenefits" />
      </Derived>
    </Fact>

    <Fact path="/writableEdcSelfReportedNonTaxablePaymentAmount">
      <Name>(Writable) Nontaxable payment amount</Name>
      <Description>(Writable) Nontaxable veterans’ pensions and any other pension, annuity, or disability benefit that
        is excluded from income under any other provision of law, used for Schedule R Line 13b</Description>

      <Writable>
        <Dollar />
      </Writable>
    </Fact>

    <Fact path="/edcInitialNonTaxableAmountForPotentialEligibility">
      <Description>The nontaxable contribution, that is an initial value for Schedule R Line 13c</Description>
      <Derived>
        <Dependency module="socialSecurity" path="/nonTaxableSocialSecurityBenefits" />
      </Derived>
    </Fact>

    <Fact path="/writableHasSelfReportedNonTaxablePayments">
      <Description>(writable) Did primary or secondary have any nontaxable payments that need to be reported</Description>

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/hasSelfReportedNonTaxablePayments">
      <Description>Did primary or secondary have any nontaxable payments that need to be reported (may be incomplete) </Description>

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/tpCanBeAskedAboutNonTaxablePayments" />
            </When>
            <Then>
              <Dependency path="/writableHasSelfReportedNonTaxablePayments" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>


    <Fact path="/edcSelfReportedNonTaxablePaymentAmount">
      <Name>Nontaxable payment amount</Name>
      <Description>Additional self reported nontaxable payment not collected elsewhere, used as part of Schedule R Line
        13b</Description>
      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <All>
                  <IsComplete>
                    <Dependency path="/hasSelfReportedNonTaxablePayments" />
                  </IsComplete>
                  <Dependency path="/hasSelfReportedNonTaxablePayments" />
                </All>
              </When>
              <Then>
                <Dependency path="/writableEdcSelfReportedNonTaxablePaymentAmount" />
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/edcNonTaxableIncomeNotIncludingSocialSecurityAndRrb">
      <Description>Nontaxable veterans pensions and any other pension, annuity, or disability benefit that is excluded
        from income under any other provision of law, used for Schedule R Line 13b
      </Description>
      <Export mef="true" />
      <Derived>
        <Add>
          <Dependency path="/edcSelfReportedNonTaxablePaymentAmount" />
          <Dependency module="income" path="/nonTaxablePensionsAndAnnuities" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/edcTotalNonTaxableAmountCal">
      <Description>Helper fact for edcTotalNonTaxableAmount to avoid repeating the calc twice</Description>
      <Derived>
        <Add>
          <Dependency path="/edcNonTaxableSocialSecurityAndRailroadBenefits" />
          <Dependency path="/edcNonTaxableIncomeNotIncludingSocialSecurityAndRrb" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/edcTotalNonTaxableAmount">
      <Description>The total nontaxable contributions, used for Schedule R Line 13c</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <GreaterThan>
                  <Left>
                    <Dependency path="/edcTotalNonTaxableAmountCal" />
                  </Left>
                  <Right>
                    <Dollar>0</Dollar>
                  </Right>
                </GreaterThan>
              </When>
              <Then>
                <Dependency path="/edcTotalNonTaxableAmountCal" />
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/edcExemptionAmount">
      <Description>1040 Schedule R Line 15: The EDC exemption amount used to calculate the AGI modified for the EDC</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine8" />
                <Dependency path="/edcLine9" />
              </Any>
            </When>
            <Then>
              <Dollar>5000</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine1" />
                <Dependency path="/edcLine2" />
              </Any>
            </When>
            <Then>
              <Dollar>7500</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="/edcLine3" />
                <Dependency path="/edcLine4" />
                <Dependency path="/edcLine5" />
                <Dependency path="/edcLine6" />
                <Dependency path="/edcLine7" />
              </Any>
            </When>
            <Then>
              <Dollar>10000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/edcMagiCalc">
      <Description>Helper fact for the edc modified AGI fact to avoid repeating the calc twice.</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency module="taxCalculations" path="/agi" />
          </Minuend>
          <Subtrahends>
            <Dependency path="/edcExemptionAmount" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/edcMagi">
      <Description>1040 Schedule R line 16: The modified AGI for the EDC</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <GreaterThan>
                  <Left>
                    <Dependency path="/edcMagiCalc" />
                  </Left>
                  <Right>
                    <Dollar>0</Dollar>
                  </Right>
                </GreaterThan>
              </When>
              <Then>
                <Dependency path="/edcMagiCalc" />
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/edcHalfMagi">
      <Description>1040 Schedule R line 17: Half of the EDC modified AGI</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/edcMagi" />
            <Rational>1/2</Rational>
          </Multiply>
        </Round>
      </Derived>
    </Fact>


    <Fact path="/edcAdjustedCreditAmount">
      <Description>1040 Schedule R line 18: The adjusted credit amount</Description>
      <Export mef="true" />

      <Derived>
        <Add>
          <Dependency path="/edcTotalNonTaxableAmount" />
          <Dependency path="/edcHalfMagi" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/edcNetCreditAmountCalc">
      <Description>Helper fact used to calculate the net EDC amount</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/lesserOfFilingStatusAmountAndTaxableDisabilityIncome" />
          </Minuend>
          <Subtrahends>
            <Dependency path="/edcAdjustedCreditAmount" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/edcNetCreditAmount">
      <Description>1040 Schedule R line 19: The net credit amount. The taxpayer is disqualified from taking EDC if the
        amount is 0 or less.</Description>
      <Export mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/hasEdcNetCreditAmount" />
            </When>
            <Then>
              <Dependency path="/edcNetCreditAmountCalc" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/hasEdcNetCreditAmount">
      <Description>Whether the taxpayer has a valid (positive non-zero) EDC net credit amount.</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/edcNetCreditAmountCalc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/netEdcAmount">
      <Description>1040 Schedule R line 20: calculated amount of the net EDC amount.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/edcNetCreditAmount" />
            <Rational>15/100</Rational>
          </Multiply>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/edcTaxLiabilityLimitCalc">
      <Description>Helper fact used calculate whether the TP has any taxes after previously calculated or claimed
        deductions are accounted for.</Description>
      <Derived>
        <Round>
          <Subtract>
            <Minuend>
              <Dependency module="taxCalculations" path="/totalTentativeTax" />
            </Minuend>
            <Subtrahends>
              <Dependency module="schedule3" path="/sched3Line1" /> <!-- PLACEHOLDER -->
              <Dependency module="cdcc" path="/cdccTotalCredit" />
              <Dependency module="schedule3" path="/sched3Line6l" /> <!-- PLACEHOLDER -->
            </Subtrahends>
          </Subtract>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/hasTaxLiabilityForEdc">
      <Description>Whether the taxpayer has any taxes that are owed. Note: EDC is a non-refundable credit so the TP must
        have a tax liability to claim it.</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/edcTaxLiabilityLimitCalc" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>


    <Fact path="/edcTaxLiabilityLimit">
      <Description>1040 Schedule R line 21: The limit for the EDC defined by the Credit Limit Worksheet. The total tax
        minus existing nonrefundable credits.</Description>
      <Export mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/hasTaxLiabilityForEdc" />
            </When>
            <Then>
              <Dependency path="/edcTaxLiabilityLimitCalc" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/totalEdc">
      <Description>1040 Schedule R line 22: The total amount for the credit for the elderly or the disabled.</Description>
      <Export mef="true" downstreamFacts="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
            </When>
            <Then>
              <LesserOf>
                <Dependency path="/netEdcAmount" />
                <Dependency path="/edcTaxLiabilityLimit" />
              </LesserOf>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isReceivingEdc">
      <Description>Whether the TP is receiving a non-zero value for the Elderly or disabled credit</Description>
      <Export mef="true" downstreamFacts="true" />
      <Derived>
        <All>
          <Dependency path="/qualifiedForCreditForElderlyAndDisabled" />
          <GreaterThan>
            <Left>
              <Dependency path="/totalEdc" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </GreaterThan>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isInitialDisabilitySectionComplete">
      <Description>Whether the intitial disability section has been completed for all eligible filers.</Description>
      <!-- Complete when the number of filers eligible through disability is equal to the sum of disqualified and
      qualified -->
      <Derived>
        <Equal>
          <Left>
            <CollectionSize>
              <Dependency path="/filersMaybeEligibleForDisability" />
            </CollectionSize>
          </Left>
          <Right>
            <Add>
              <CollectionSize>
                <Filter path="/filersMaybeEligibleForDisability">
                  <Dependency path="initialDisabilityIsComplete" />
                </Filter>
              </CollectionSize>
            </Add>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/filers/*/initialDisabilityIsComplete">
      <Description>Whether the initial disability section can be considered complete for the filer</Description>
      <Derived>
        <IsComplete>
          <Dependency path="../hasTaxableDisabilityPaymentsAndRetOnDisability" />
        </IsComplete>
      </Derived>
    </Fact>

    <Fact path="/filersQualifiedForEdcThroughDisability">
      <Description>The collection of filers who are qualified for the EDC via the disabled path. Note: they may still be
        disqualified from downstream questions / calculations</Description>
      <Derived>
        <Filter path="/filersMaybeEligibleForDisability">
          <Dependency path="isMaybeQualifiedforEdcThroughDisability" />
        </Filter>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isDisqualifiedFromEdcThroughDisability">
      <Description>Whether the taxpayer has been disqualified from the disability path for EDC.</Description>
      <Derived>
        <Not>
          <Dependency path="../isMaybeQualifiedforEdcThroughDisability" />
        </Not>
      </Derived>
    </Fact>

    <Fact path="/isDisqualifiedFromEdcBasedOnAgiLimit">
      <Description>Whether the TP was disqualified from EDC based on their AGI and filing status.</Description>
      <Derived>
        <Any>
          <Not>
            <Dependency path="/maybeEligibleForEdcBasedOnRelaxedAgiLimit" />
          </Not>
          <Not>
            <Dependency path="/isQualifiedForEdcBasedOnAgiLimit" />
          </Not>
        </Any>
      </Derived>
    </Fact>

    <Fact path="/isDisqualifiedFromEdcBasedOnTaxLiability">
      <Description>Whether the TP cannot claim EDC because after already known deductions their tax liability would be
        0.</Description>
      <!-- TODO figure out if we need to order this prior to AGI or as-is-->
      <Derived>
        <All>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnAgiLimit" />
          </Not>
          <IsComplete>
            <Dependency path="/hasTaxLiabilityForEdc" />
          </IsComplete>
          <Not>
            <Dependency path="/hasTaxLiabilityForEdc" />
          </Not>
        </All>
      </Derived>
    </Fact>

    <Fact path="/isDisqualifiedFromEdcBasedOnNonTaxablePayments">
      <Description>Whether the TP was disqualified from EDC based on their nontaxable payments and filing status and not
        other disquals.</Description>
      <Derived>
        <All>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnAgiLimit" />
          </Not>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnTaxLiability" />
          </Not>
          <Any>
            <Not>
              <Dependency path="/isMaybeEligibleForEdcBasedOnNonTaxablePayments" />
            </Not>
            <All>
              <IsComplete>
                <Dependency path="/isQualifiedForEdcBasedOnNonTaxablePayments" />
              </IsComplete>
              <Not>
                <Dependency path="/isQualifiedForEdcBasedOnNonTaxablePayments" />
              </Not>
            </All>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isDisqualifedFromEdcBasedOnAgeOrDisability">
      <Description>Whether the filer has been disqualified from EDC based on the age requirement and their answer to
        retired on total disability and not due to previous disquals.</Description>
      <Derived>
        <All>
          <Dependency module="filers" path="../isPrimaryFilerOrMfjAndEither" />
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnAgiLimit" />
          </Not>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnTaxLiability" />
          </Not>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnNonTaxablePayments" />
          </Not>
          <Not>
            <Dependency module="filers" path="../age65OrOlder" />
          </Not>
          <All>
            <IsComplete>
              <Dependency path="../isRetOnPermOrTotalDisability" />
            </IsComplete>
            <Not>
              <Dependency path="../isRetOnPermOrTotalDisability" />
            </Not>
          </All>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isDisqualifiedByMandatoryRetirementAge">
      <Description>Whether the filer was disqualified from the disabled path through meeting the mandatory retirement
        age.</Description>
      <Derived>
        <All>
          <Dependency module="filers" path="../isPrimaryFilerOrMfjAndEither" />
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnAgiLimit" />
          </Not>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnTaxLiability" />
          </Not>
          <Not>
            <Dependency path="/isDisqualifiedFromEdcBasedOnNonTaxablePayments" />
          </Not>
          <Not>
            <Dependency path="../isDisqualifedFromEdcBasedOnAgeOrDisability" />
          </Not>
          <Not>
            <Dependency module="filers" path="../age65OrOlder" />
          </Not>
          <Not>
            <Dependency path="../hasDisabilityIncome" />
          </Not>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isDisqualifiedFromEdcBasedOnTaxableDisabilityIncome">
      <Description>Whether the filer has been disqualified from EDC based on their taxable disability income and not
        other disquals.</Description>
      <Derived>
        <All>
          <Dependency path="../maybeEligibleForDisabilityCredit" />
          <Dependency path="../isRetOnPermOrTotalDisability" />
          <Not>
            <Dependency path="../isMaybeQualifiedforEdcThroughDisability" />
          </Not>
          <IsComplete>
            <Dependency path="../hasDisabilityIncome" />
          </IsComplete>
          <Any>
            <Not>
              <Dependency path="../hasDisabilityIncome" />
            </Not>
            <All>
              <IsComplete>
                <Dependency path="../arePaymentsTaxDisabilityIncome" />
              </IsComplete>
              <Not>
                <Dependency path="../arePaymentsTaxDisabilityIncome" />
              </Not>
            </All>
            <Equal>
              <Left>
                <Dependency path="../totalTaxableDisabilityAmount" />
              </Left>
              <Right>
                <Dollar>0</Dollar>
              </Right>
            </Equal>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/filersMaybeEligibleForDisability">
      <Description>The collection of filers who might be eligible for the Elderly or Disabled Credit via the disabled
        path.</Description>
      <Derived>
        <Filter path="/filers">
          <Dependency path="maybeEligibleForDisabilityCredit" />
        </Filter>
      </Derived>
    </Fact>

    <Fact path="/filers/*/maybeEligibleForDisabilityCredit">
      <Description>Whether the filer might be eligible for disability through the EDC and we need to ask them additional
        questions.</Description>
      <Derived>
        <All>
          <Dependency path="/maybeEligibleForCreditForElderlyAndDisabled" />
          <Not>
            <Dependency module="filers" path="../age65OrOlder" />
          </Not>
          <Dependency module="filers" path="../isPrimaryFilerOrMfjAndEither" />
          <Any>
            <!-- Primary filer has taxable income that could be disability income -->
            <All>
              <Dependency module="filers" path="../isPrimaryFiler" />
              <Dependency module="formW2s" path="/primaryFilerHasW2WagesGreaterThan0" />
            </All>
            <!-- Same for Secondary filer ^ -->
            <All>
              <Dependency module="filers" path="../isSecondaryFiler" />
              <Dependency module="formW2s" path="/secondaryFilerHasW2WagesGreaterThan0" />
            </All>
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/secondaryFilerIsEligibleForEdcThroughDisability">
      <Description>Is the secondary filer eligible for EDC through disability, used for MeF to ensure filer is also MFJ</Description>
      <Export mef="true" />
      <Derived>
        <All>
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
          <Dependency path="/secondaryFiler/isMaybeQualifiedforEdcThroughDisability" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/edcShouldShowCreditOutcomes">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/tpCanBeAskedAboutNonTaxablePayments" />
            </When>
            <Then>
              <IsComplete>
                <Dependency path="/hasSelfReportedNonTaxablePayments" />
              </IsComplete>
            </Then>
          </Case>
          <When>
            <True />
          </When>
          <Then>
            <True />
          </Then>
        </Switch>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>

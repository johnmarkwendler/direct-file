<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/directFileLanguagePreference">
      <Name>Direct File Language Preference</Name>
      <Description>The language the filer wants to received communications from Direct File in</Description>

      <Writable>
        <String />
      </Writable>
    </Fact>


    <Fact path="/timeZoneOptions">
      <Derived>
        <EnumOptions>
          <String>HST</String>
          <String>HADT</String>
          <String>AKT</String>
          <String>PT</String>
          <String>MT</String>
          <String>CT</String>
          <String>ET</String>
          <String>MIL</String>
        </EnumOptions>
      </Derived>
    </Fact>


    <Fact path="/offset">
      <Derived>
        <Switch>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    ET
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-4</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    CT
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-5</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    MT
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-6</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    PT
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-7</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    AKT
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-8</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    HADT
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-9</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    HST
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-10</Int>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/stateTimezone" />
                </Left>
                <Right>
                  <Enum optionsPath="/timeZoneOptions">
                    MIL
                  </Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Int>-12</Int>
            </Then>
          </Case>


        </Switch>
      </Derived>
    </Fact>


    <Fact path="/stateTimezone">
      <Derived>
        <Switch>
          <!-- If we don't have an address yet, we need to pick some timezone
          We pick the most generous timezone the product supports, on the assumption
          the user MIGHT be in that timezone and so we should offer to support them
          until we know where they actually live
          -->
          <Case>
            <When>
              <Not>
                <IsComplete>
                  <Dependency path="/address" module="filers" />
                </IsComplete>
              </Not>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MIL
              </Enum>
            </Then>
          </Case>

          <!-- For each US state, we pick the most "generous" timezone the state might use;
          that is, if a state is Central Time and Mountain Time (like SD), we'll pick mountain time -->

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AL</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AK</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                HADT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AZ</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AR</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>CA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>CO</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>CT</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>DE</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>DC</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>FL</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>GA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>HI</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                HST
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>ID</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>IL</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>IN</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>IA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>KS</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>KY</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>LA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>ME</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MD</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MI</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MN</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MS</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MO</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>MT</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NE</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NV</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NH</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NJ</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NM</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NY</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>NC</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>ND</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>OH</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>OK</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>OR</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>PA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>RI</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>SC</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>SD</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>TN</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>TX</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>UT</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>VT</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>VA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>WA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                PT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>WV</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                ET
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>WI</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                CT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>WY</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MT
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AA</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MIL
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AE</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MIL
              </Enum>
            </Then>
          </Case>

          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/address/stateOrProvence" module="filers" />
                </Left>
                <Right>
                  <String>AP</String>
                </Right>
              </Equal>
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MIL
              </Enum>
            </Then>
          </Case>

          <!-- Taxpayer must have imported an address with a state that we don't otherwise support, like PR.
          Creating this special case at least prevents <Today> from breaking elsewhere in the application. -->

          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Enum optionsPath="/timeZoneOptions">
                MIL
              </Enum>
            </Then>
          </Case>

        </Switch>
      </Derived>
    </Fact>

    <Fact path="/todayOverride" testOnly="true">
      <Description>USED FOR TESTING. Manually set a fact for what "Today" is since mocking Dates in the fact graph is
        tricky in typescript</Description>
      <Writable>
        <Day />
      </Writable>
    </Fact>

    <Fact path="/today">
      <Description>Today, in the filer's timezone of residence</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <IsComplete>
                <Dependency path="/todayOverride" />
              </IsComplete>
            </When>
            <Then>
              <Dependency path="/todayOverride" />
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Today>
                <Dependency path="/offset" />
              </Today>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/hasSeenReviewScreen">
      <Name>Has seen review screen</Name>
      <Description>The user has seen the review screen</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/lastYearAgiFromOLA">
      <Description>
        The user's last year's AGI as loaded from their OLA account.
        This should probably be a dollar amount,
        but was a bug from TY2023.
      </Description>
      <Writable>
        <Int />
      </Writable>
    </Fact>

    <Fact path="/filedLastYear">
      <Name>Filed last year</Name>
      <Description>Has the taxpayer filed last year</Description>
      <Export mef="true" downstreamFacts='true' />

      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/needsDateOfBirthToSign">
      <Derived>
        <Any>
          <Not>
            <Dependency path='/filedLastYear' />
          </Not>
          <Dependency module='filers' path="/primaryFilerHasIpPin" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/isFilingMFJAndIsWidowedInTaxYear">
      <Name>TP is filing MFJ and is widowed in tax year</Name>
      <Derived>
        <All>
          <Dependency module="filers" path="/isWidowedInTaxYear" />
          <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
        </All>
      </Derived>
    </Fact>


    <Fact path="/spouseFiledLastYear">
      <Name>Spouse filed last year</Name>
      <Description>Has the taxpayer's spouse filed last year</Description>
      <Export downstreamFacts='true' />
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/spouseNeedsDateOfBirthToSign">
      <Derived>
        <Any>
          <Not>
            <Dependency path='/spouseFiledLastYear' />
          </Not>
          <Dependency module='filers' path="/spouseHasIpPin" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/signReturnIdentityOptions">
      <Name>Tax return identity Options</Name>
      <Description>Options for how the TP wants to sign their tax return</Description>
      <Derived>
        <EnumOptions>
          <String>lastYearAgi</String>
          <String>lastYearPin</String>
          <String>cannotFind</String>
        </EnumOptions>
      </Derived>
    </Fact>

    <Fact path="/signReturnIdentity">
      <Name>How the TP wants to confirm their identity</Name>
      <Description>Using self-select PIN, last year's AGI and date of birth, or they cannot find either of these.</Description>

      <Writable>
        <Enum optionsPath="/signReturnIdentityOptions" />
      </Writable>
    </Fact>


    <Fact path="/signReturnIdentitySpouseOptions">
      <Name>Tax return identity Options</Name>
      <Description>Options for how the TP's spouse wants to sign their tax return</Description>
      <Derived>
        <EnumOptions>
          <String>lastYearAgi</String>
          <String>lastYearPin</String>
          <String>cannotFind</String>
        </EnumOptions>
      </Derived>
    </Fact>

    <Fact path="/signReturnIdentitySpouse">
      <Name>How the TP wants to confirm their identity</Name>
      <Description>Using self-select PIN, last year's AGI and date of birth, or they cannot find either of these.</Description>

      <Writable>
        <Enum optionsPath="/signReturnIdentitySpouseOptions" />
      </Writable>
    </Fact>

    <Fact path='/isPaperPathDueToMissingIpPin'>
      <Derived>
        <Any>
          <Dependency module='filers' path='/primaryFilerIsMissingIpPin' />
          <Dependency module='filers' path='/secondaryFilerIsMissingIpPin' />
          <Dependency module='familyAndHousehold' path='/oneOrMoreDependentsAreMissingIpPin' />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/isEssarFeatureFlag">
      <Name>Is ESSAR Enabled</Name>
      <Description>Is the electronic signing flow (and use of ESSAR) enabled through a build flag</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/hasFailedMaxElectronicSigningAttempts">
      <Name>(UNUSED) Has Electronic Signing Failed</Name>
      <Description>Note: this fact has been deprecated and is no longer used. It should be removed after filing season.
        True when the maximum configured number of attempts to electronically sign a return has been reached</Description>
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/canUseElectronicSignatureFlow">
      <Name>(UNUSED) Is eSign flow enabled</Name>
      <Description>Note: this fact has been deprecated and is no longer used. It should be removed after filing season.
        Is the electronic signature flow available for this tax return</Description>
      <Derived>
        <All>
          <Dependency path='/isEssarFeatureFlag' />
        </All>
      </Derived>
    </Fact>

    <Fact path="/isLegacySigningPath">
      <Name>Is not compatible with electronic signing</Name>
      <Description>Is not compatible with electronic signing</Description>
      <Export downstreamFacts='true' />
      <Derived>
        <Any>
          <Dependency path='/isPaperPathDueToMissingIpPin' />
          <Dependency module="spouseSection" path="/isMFJWithLivingSpouse" />
          <Not>
            <Dependency path="/isEssarFeatureFlag" />
          </Not>
        </Any>
      </Derived>
    </Fact>

    <Fact path='/isPaperPath'>
      <Name>Whether the return is on a paper filing path</Name>
      <Description>Either the TP is missing an IP Pin or they cannot find their last
        year's AGI or Self-Select Pin in the
        Sign and Submit section.</Description>
      <Export downstreamFacts='true' />
      <Derived>
        <Any>
          <Dependency path='/isPaperPathDueToMissingIpPin' />
          <Dependency path='/cannotFindPinOrAgi' />
          <Dependency path='/spouseCannotFindPinOrAgi' />
        </Any>
      </Derived>
    </Fact>

    <Fact path='/isPaperPathAndWantedToPayViaAch'>
      <Name>If the filer is on a paper filing path and set their payment method to direct deposit</Name>
      <Derived>
        <All>
          <Dependency path='/isPaperPath' />
          <Dependency module='paymentMethod' path='/payViaAch' />
        </All>
      </Derived>
    </Fact>

    <Fact path='/isPaperPathAndNoPaymentChoiceOrWasAutocorrected'>
      <Name>If the filer is on a paper filing path and did not have a payment method chosen</Name>
      <Derived>
        <All>
          <Dependency path='/isPaperPath' />
          <Any>
            <Not>
              <IsComplete>
                <Dependency module='paymentMethod' path='/payViaAch' />
              </IsComplete>
            </Not>
            <Dependency module="flow" path="/flowHasSeenPaymentMethodAutocorrect" />
          </Any>
        </All>
      </Derived>
    </Fact>

    <Fact path="/willEnterLastYearPin">
      <Export downstreamFacts="true" />
      <Derived>
        <Equal>
          <Left>
            <Dependency path='/signReturnIdentity' />
          </Left>
          <Right>
            <Enum optionsPath='/signReturnIdentityOptions'>lastYearPin</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/willEnterLastYearAgi">
      <Export downstreamFacts="true" />
      <Derived>
        <Equal>
          <Left>
            <Dependency path='/signReturnIdentity' />
          </Left>
          <Right>
            <Enum optionsPath='/signReturnIdentityOptions'>lastYearAgi</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/cannotFindPinOrAgi">
      <Derived>
        <All>
          <Equal>
            <Left>
              <Dependency path='/signReturnIdentity' />
            </Left>
            <Right>
              <Enum optionsPath='/signReturnIdentityOptions'>cannotFind</Enum>
            </Right>
          </Equal>
          <Dependency path='/filedLastYear' />
        </All>
      </Derived>
    </Fact>

    <Fact path="/spouseWillEnterLastYearPin">
      <Export downstreamFacts="true" />
      <Derived>
        <Equal>
          <Left>
            <Dependency path='/signReturnIdentitySpouse' />
          </Left>
          <Right>
            <Enum optionsPath='/signReturnIdentitySpouseOptions'>lastYearPin</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/spouseWillEnterLastYearAgi">
      <Export downstreamFacts="true" />
      <Derived>
        <Equal>
          <Left>
            <Dependency path='/signReturnIdentitySpouse' />
          </Left>
          <Right>
            <Enum optionsPath='/signReturnIdentitySpouseOptions'>lastYearAgi</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/spouseCannotFindPinOrAgi">
      <Derived>
        <All>
          <Equal>
            <Left>
              <Dependency path='/signReturnIdentitySpouse' />
            </Left>
            <Right>
              <Enum optionsPath='/signReturnIdentitySpouseOptions'>cannotFind</Enum>
            </Right>
          </Equal>
          <Dependency path='/spouseFiledLastYear' />
        </All>
      </Derived>
    </Fact>

    <Fact path="/needsToEnterLastYearAgi">
      <Derived>
        <All>
          <Dependency path="/filedLastYear" />
          <Dependency path="/willEnterLastYearAgi" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/spouseNeedsToEnterLastYearAgi">
      <Derived>
        <All>
          <Dependency module="spouseSection" path="/isMFJWithLivingSpouse" />
          <Dependency path="/spouseFiledLastYear" />
          <Dependency path="/spouseWillEnterLastYearAgi" />
        </All>
      </Derived>
    </Fact>

    <Fact path="/lastYearAgi">
      <Name>Last year's AGI</Name>
      <Description>Taxpayer's AGI from the last year</Description>
      <Export downstreamFacts="true" />

      <Writable>
        <Dollar />
      </Writable>
    </Fact>

    <Fact path="/spouseLastYearAgi">
      <Name>Last year's AGI for Spouse</Name>
      <Description>Taxpayer's spouse's AGI from the last year</Description>
      <Export downstreamFacts="true" />
      <Writable>
        <Dollar />
      </Writable>
    </Fact>

    <Fact path="/primaryPriorYearAGIAmount">
      <Name>primaryPriorYearAGIAmount</Name>
      <Description>Primary filer's prior year AGI amount.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <All>
                  <Not>
                    <Dependency path="/filedLastYear" />
                  </Not>
                  <Not>
                    <Dependency module="filers" path="/primaryFilerHasIpPin" />
                  </Not>
                </All>
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
            <Case>
              <When>
                <All>
                  <Not>
                    <Dependency module="filers" path="/primaryFilerHasIpPin" />
                  </Not>
                  <Dependency path="/needsToEnterLastYearAgi" />
                </All>
              </When>
              <Then>
                <Dependency path="/lastYearAgi" />
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/spousePriorYearAGIAmount">
      <Name>spousePriorYearAGIAmount</Name>
      <Description>Spouse's prior year AGI amount.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <All>
                  <Dependency module="spouseSection" path="/isMFJWithLivingSpouse" />
                  <Not>
                    <Dependency path="/spouseFiledLastYear" />
                  </Not>
                  <Not>
                    <Dependency module="filers" path="/spouseHasIpPin" />
                  </Not>
                </All>
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
            <Case>
              <When>
                <All>
                  <Not>
                    <Dependency module="filers" path="/spouseHasIpPin" />
                  </Not>
                  <Dependency path="/spouseNeedsToEnterLastYearAgi" />
                </All>
              </When>
              <Then>
                <Dependency path="/spouseLastYearAgi" />
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/selfSelectPin">
      <Name>Self-Select PIN</Name>
      <Description>The self-select pin number of the taxpayer(s).</Description>
      <Export downstreamFacts="true" mef="true" />
      <Writable>
        <PIN />
      </Writable>
    </Fact>

    <Fact path="/selfSelectPinLastYear">
      <Name>Last Year's Self-Select PIN</Name>
      <Description>The self-select pin number of the taxpayer(s) for the last tax year.</Description>
      <Export downstreamFacts="true" />
      <Writable>
        <PIN />
      </Writable>
    </Fact>

    <Fact path="/xmlSelfSelectPinLastYear">
      <Name>Last Year's Self-Select PIN</Name>
      <Description>The self-select pin number of the taxpayer(s) for the last tax year. Used to populate the IRS Return
        Header SelfSelectPINGrp.PrimaryPriorYearPIN XML element.</Description>
      <Export mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <All>
                <Dependency path="/willEnterLastYearPin" />
                <Not>
                  <Dependency module='filers' path="/primaryFilerHasIpPin" />
                </Not>
              </All>
            </When>
            <Then>
              <Dependency path="/selfSelectPinLastYear" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/spouseSelfSelectPin">
      <Name>Self-Select PIN for Taxpayer's Spouse</Name>
      <Description>The self-select pin number of the taxpayer's spouse.</Description>
      <Export downstreamFacts="true" />
      <Writable>
        <PIN />
      </Writable>
    </Fact>

    <Fact path="/xmlSpouseSelfSelectPin">
      <Description>The self-select pin used by the XML. The spouse's self select pin should not be used when the spouse
        is deceased</Description>
      <Export mef="true" />
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="spouseSection" path="/isMFJWithLivingSpouse" />
            </When>
            <Then>
              <Dependency path="/spouseSelfSelectPin" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/spouseSelfSelectPinLastYear">
      <Name>Last Year's Self-Select PIN for Spouse of taxpayer</Name>
      <Description>The self-select pin number of the taxpayer's spouse for the last tax year.</Description>
      <Export downstreamFacts="true" />

      <Writable>
        <PIN />
      </Writable>
    </Fact>

    <Fact path="/xmlSpouseSelfSelectPinLastYear">
      <Name>Last Year's Self-Select PIN for Spouse of taxpayer</Name>
      <Description>The self-select pin number of the taxpayer's spouse for the last tax year. Used to populate the IRS
        Return Header SelfSelectPINGrp.SpousePriorYearPIN XML element.The spouse's self select pin should not be used
        when the spouse
        is deceased.</Description>
      <Export mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <All>
                <Dependency module="spouseSection" path="/isMFJWithLivingSpouse" />
                <Dependency path="/spouseWillEnterLastYearPin" />
                <Not>
                  <Dependency module='filers' path="/spouseHasIpPin" />
                </Not>
              </All>
            </When>
            <Then>
              <Dependency path="/spouseSelfSelectPinLastYear" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/isUsingDirectDeposit">
      <Name>Whether the taxpayer is using direct deposit or not</Name>
      <Derived>
        <Any>
          <Dependency module="paymentMethod" path='/refundViaAch' />
          <Dependency module="paymentMethod" path='/payViaAch' />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/isUsingBankAccountToPay">
      <Name>Whether the taxpayer is using direct deposit to pay the taxes they owe</Name>
      <Derived>
        <All>
          <Dependency module="taxCalculations" path='/owesBalance' />
          <Dependency module="paymentMethod" path='/payViaAch' />
        </All>
      </Derived>
    </Fact>

  </Facts>
</FactDictionaryModule>

<?xml-model href="./FactDictionaryModule.rng"?>
<!-- This module holds income types that do not exist in their own modules -->
<FactDictionaryModule>
  <Facts>

    <Fact path="/totalExemptPrimaryAndSpouseCount">
      <Name>Total Exempt Primary And Spouse Count</Name>
      <Description>Total Exempt Primary And Spouse Count</Description>
      <Export mef="true" />

      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Int>2</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Int>1</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/totalExemptionsCount">
      <Name>Total Exemptions Count</Name>
      <Description>The sum of the number of claimed dependents and total exempt primary and spouse
        count</Description>
      <Export mef="true" />

      <Derived>
        <Add>
          <CollectionSum>
            <Dependency path="/totalExemptPrimaryAndSpouseCount" />
          </CollectionSum>
          <CollectionSum>
            <Dependency module="familyAndHousehold" path="/claimedDependentsCount" />
          </CollectionSum>
        </Add>
      </Derived>
    </Fact>

    <Fact path="/adjustmentsToIncome">
      <Name>Adjustments to income</Name>
      <Description>Adjustments to income to report on line 10 of Form 1040 and line 26 of Schedule.</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency module="studentLoanAdjustment" path="/studentLoanInterestAdjustmentAmount" />
            <Dependency path="/adjustmentsToIncomeExcludingStudentLoanInterest" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/adjustmentsToIncomeExcludingStudentLoanInterest">
      <Description>The adjustments to income used in the calculatation of non-IRA deduction MAGIs to determine deducible
        amounts. Used in the Student Loan Interest Deduction and Social Security Benefits Worksheets. This should
        include be a sum of Schedule 1, lines 11 through 20, and 23 and 25</Description>
      <Export downstreamFacts="true" />
      <Derived>
        <Add>
          <!-- Educator Expenses -->
          <Dependency module="educatorAdjustment" path="/educatorExpensesAdjustment" />
          <!-- Health savings account deduction -->
          <Switch>
            <Case>
              <When>
                <IsComplete>
                  <Dependency module="hsa" path="/hsaTotalDeductibleAmount" />
                </IsComplete>
              </When>
              <Then>
                <Dependency module="hsa" path="/hsaTotalDeductibleAmount" />
              </Then>
            </Case>
            <Case>
              <When>
                <True />
              </When>
              <Then>
                <Dollar>0</Dollar>
              </Then>
            </Case>
          </Switch>
          <!-- Certain business expenses of reservists, performing artists, and fee-basis government officials. -->
          <!-- Moving expenses for members of the Armed Forces. Attach Form 3903  -->
          <!-- Deductible part of self-employment tax. Attach Schedule SE -->
          <!-- Self-employed SEP, SIMPLE, and qualified plans -->
          <!-- Self-employed health insurance deduction -->
          <!-- Penalty on early withdrawal of savings -->
          <!-- Alimony paid -->
          <!-- IRA deduction -->
          <!-- Archer MSA deduction  -->
          <!-- Total other adjustments -->
        </Add>
      </Derived>
    </Fact>

    <Fact path="/agi">
      <Name>Adjusted Gross Income</Name>
      <Description>Total income to report on line 11 of Form 1040.</Description>
      <Export downstreamFacts="true" mef="true" />

      <Derived>
        <Round>
          <Subtract>
            <Minuend>
              <Dependency module="income" path="/totalIncome" />
            </Minuend>
            <Subtrahends>
              <Dependency path="/adjustmentsToIncome" />
            </Subtrahends>
          </Subtract>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/magiForStudentLoanInterestDeduction">
      <Name>Modified Adjusted Gross Income for Student Loan Interest Deduction</Name>
      <Description>This is AGI, but without student loan interest deduction. Line 4 of the Student Loan Interest
        Deduction Worksheet used for Schedule 1</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <Subtract>
          <Minuend>
            <Dependency module="income" path="/totalIncome" />
          </Minuend>
          <Subtrahends>
            <Dependency path="/adjustmentsToIncomeExcludingStudentLoanInterest" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/taxableIncome">
      <Name>Taxable income</Name>
      <Description>Taxable income as reported on line 15 of Form 1040.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/agi" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/totalDeductions" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/qualifiedBusinessIncomeDeduction">
      <Name>Qualified business income deduction</Name>
      <Description>Qualified business income deductions for line 13 of Form 1040</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>

    <Fact path="/totalDeductions">
      <Name>Total deductions</Name>
      <Description>Total deductions as reported on line 14 of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency path="/standardOrItemizedDeductions" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/wantsStandardDeduction">
      <Name>Wants standard deduction</Name>
      <Description>Will the taxpayer take the standard deduction?</Description>

      <Derived>
        <True />
      </Derived>
    </Fact>

    <Fact path="/standardOrItemizedDeductions">
      <Name>Standard or itemized deductions</Name>
      <Description>The taxpayer's choice of standard or itemized deductions as reported on line 12
        of Form 1040.
        Currently only the standard deduction is supported.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Switch>
            <Case>
              <When>
                <Dependency path="/wantsStandardDeduction" />
              </When>
              <Then>
                <Dependency module="standardDeduction" path="/standardDeduction" />
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/adjustmentsTotal">
      <Name>Other Deductions</Name>
      <Description>Deductions such as educator expenses and student loan interest</Description>
      <Derived>
        <Add>
          <Dependency module="educatorAdjustment" path="/educatorExpensesAdjustment" />
          <Dependency module="studentLoanAdjustment" path="/studentLoanInterestAdjustmentAmount" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/hasAdjustments">
      <Name>Has adjustments</Name>
      <Description>Whether there are adjustments such as educator expenses and student loan interest greater than zero</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/adjustmentsTotal" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/form8814Included">
      <Name>8814 Included</Name>
      <Description>Is Form 8814 included</Description>
      <Derived>
        <False />
      </Derived>
    </Fact>

    <Fact path="/form4972Included">
      <Name>4972 Included</Name>
      <Description>Is Form 4972 included</Description>
      <Derived>
        <False />
      </Derived>
    </Fact>

    <Fact path="/formOtherIncluded">
      <Name>Other Included</Name>
      <Description>Is another form included</Description>
      <Derived>
        <False />
      </Derived>
    </Fact>

    <Fact path="/otherFormName">
      <Name>Other Form Name</Name>
      <Description>the name of the other form included</Description>
      <Derived>
        <String></String>
      </Derived>
    </Fact>

    <Fact path="/roundedTaxableIncome">
      <Name>Rounded taxable income</Name>
      <Description>Income less than $100,000 uses the tax tables from the Instructions for Form
        1040. This fact selects
        the "midpoint" that corresponds to each entry in the tax tables, for use in calculating
        tenative tax.</Description>
      <Derived>
        <Switch>
          <!-- No tax if you've got no taxable income -->
          <Case>
            <When>
              <LessThanOrEqual>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>0</Dollar>
                </Right>
              </LessThanOrEqual>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <!-- There are three hardcoded midpoints for income less than $25 -->
          <Case>
            <When>
              <LessThan>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>5</Dollar>
                </Right>
              </LessThan>
            </When>
            <Then>
              <Dollar>2.50</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <LessThan>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>15</Dollar>
                </Right>
              </LessThan>
            </When>
            <Then>
              <Dollar>10</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <LessThan>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>25</Dollar>
                </Right>
              </LessThan>
            </When>
            <Then>
              <Dollar>20</Dollar>
            </Then>
          </Case>
          <!-- The tax tables use increments of $25 for income between $25 and $3,000 -->
          <Case>
            <When>
              <LessThan>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>3000</Dollar>
                </Right>
              </LessThan>
            </When>
            <Then>
              <Add>
                <StepwiseMultiply>
                  <Multiplicand>
                    <Dependency path="/taxableIncome" />
                  </Multiplicand>
                  <Rate>
                    <Rational>25/25</Rational> <!-- $25 for every whole $25 of income -->
                  </Rate>
                </StepwiseMultiply>
                <Dollar>12.50</Dollar> <!-- Add $12.50 to find the midpoint of the row -->
              </Add>
            </Then>
          </Case>
          <!-- The tax tables use increments of $50 for income between $3,000 and $100,000 -->
          <Case>
            <When>
              <LessThan>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>100000</Dollar>
                </Right>
              </LessThan>
            </When>
            <Then>
              <Add>
                <StepwiseMultiply>
                  <Multiplicand>
                    <Dependency path="/taxableIncome" />
                  </Multiplicand>
                  <Rate>
                    <Rational>50/50</Rational> <!-- $50 for every whole $50 of income -->
                  </Rate>
                </StepwiseMultiply>
                <Dollar>25</Dollar> <!-- Add $25 to find the midpoint of the row -->
              </Add>
            </Then>
          </Case>
          <!-- Income of $100,000 and over uses the tax computation worksheet -->
          <Case>
            <When>
              <GreaterThanOrEqual>
                <Left>
                  <Dependency path="/taxableIncome" />
                </Left>
                <Right>
                  <Dollar>100000</Dollar>
                </Right>
              </GreaterThanOrEqual>
            </When>
            <Then>
              <Dependency path="/taxableIncome" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/tentativeTaxFromTaxableIncome">
      <Name>Tentative tax from taxable income</Name>
      <Description>Tentative tax as reported on line 16 of Form 1040.
        Rev Proc .01 Tax Rate Tables §1(j)(2)(A|B|C|D)
        TODO: Replace Any/Equal with Include</Description>
      <Export mef="true" />
      <ExportZero />
      <TaxYear>2024</TaxYear>

      <Derived>
        <Round>
          <Switch>
            <!-- MARRIED FILING JOINTLY AND QUALIFIED SURVIVING SPOUSE -->
            <Case>
              <When>
                <Any>
                  <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
                  <Dependency module="filingStatus" path="/isFilingStatusQSS" />
                </Any>
              </When>
              <Then>
                <Switch>
                  <!-- Not over $23,200: 10% of the taxable income -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>23200</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Dependency path="/roundedTaxableIncome" />
                      </Multiply>
                    </Then>
                  </Case>

                  <!-- Over $23,200 but not over $94,300:
                $2,320 plus 12% of the excess over $23,200 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>94300</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>2320</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>23200</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $94,300 but not over $201,050:
                $10,852 plus 22% of the excess over $94,300 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>201050</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>10852</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>94300</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $201,050 but not over $383,900:
                $34,337 plus 24% of the excess over $201,050 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>383900</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>34337</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>201050</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $383,900 but not over $487,450:
                $78,221 plus 32% of the excess over $383,900 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>487450</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>78221</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>383900</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $487,450 but not over $731,200:
                $111,357 plus 35% of the excess over $487,450 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>731200</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>111357</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>487450</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $731,200:
                $196,669.50 plus 37% of the excess over $731,200 -->
                  <Case>
                    <When>
                      <GreaterThan>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>731200</Dollar>
                        </Right>
                      </GreaterThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>196669.50</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>731200</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>

            <!-- HEAD OF HOUSEHOLD -->
            <Case>
              <When>
                <Dependency module="filingStatus" path="/isFilingStatusHOH" />
              </When>
              <Then>
                <Switch>
                  <!-- Not over $16,550: 10% of the taxable income -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>16550</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Dependency path="/roundedTaxableIncome" />
                      </Multiply>
                    </Then>
                  </Case>

                  <!-- Over $16,550 but not over $63,100:
                $1,655 plus 12% of the excess over $16,550 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>63100</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>1655</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>16550</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $63,100 but not over $100,500:
                $7,241 plus 22% of the excess over $63,100 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>100500</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>7241</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>63100</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $100,500 but not over $191,950:
                   $15,469 plus 24% of the excess over $100,500 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>191950</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>15469</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>100500</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $191,950 but not over $243,700:
                   $37,417 plus 32% of the excess over $191,950 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>243700</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>37417</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>191950</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $243,700 but not over $609,350:
                   $53,977 plus 35% of the excess over $243,700 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>609350</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>53977</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>243700</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $609,350:
                   $181,954.50 plus 37% of the excess over $609,350 -->
                  <Case>
                    <When>
                      <GreaterThan>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>609350</Dollar>
                        </Right>
                      </GreaterThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>181954.50</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>609350</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>

            <!-- SINGLE -->
            <Case>
              <When>
                <Dependency module="filingStatus" path="/isFilingStatusSingle" />
              </When>
              <Then>
                <Switch>
                  <!-- Not over $11,600: 10% of the taxable income -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>11600</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Dependency path="/roundedTaxableIncome" />
                      </Multiply>
                    </Then>
                  </Case>

                  <!-- Over $11,600 but not over $47,150:
                   $1,160 plus 12% of the excess over $11,600 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>47150</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>1160</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>11600</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $47,150 but not over $100,525:
                   $5,426 plus 22% of the excess over $47,150 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>100525</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>5426</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>47150</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $100,525 but not over $191,950:
                   $17,168.50 plus 24% of the excess over $100,525 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>191950</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>17168.50</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>100525</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $191,950 but not over $243,725:
                   $39,110.50 plus 32% of the excess over $191,950 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>243725</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>39110.50</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>191950</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $243,725 but not over $609,350:
                   $55,678.50 plus 35% of the excess over $243,725 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>609350</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>55678.50</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>243725</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $609,350:
                   $183,647.25 plus 37% of the excess over $609,350 -->
                  <Case>
                    <When>
                      <GreaterThan>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>609350</Dollar>
                        </Right>
                      </GreaterThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>183647.25</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>609350</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>

            <!-- MARRIED FILING SEPARATELY -->
            <Case>
              <When>
                <Dependency module="filingStatus" path="/isFilingStatusMFS" />
              </When>
              <Then>
                <Switch>
                  <!-- Not over $11,600: 10% of the taxable income -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>11600</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Dependency path="/roundedTaxableIncome" />
                      </Multiply>
                    </Then>
                  </Case>

                  <!-- Over $11,600 but not over $47,150:
                   $1,160 plus 12% of the excess over $11,600 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>47150</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>1160</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>11600</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $47,150 but not over $100,525:
                   $5,426 plus 22% of the excess over $47,150 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>100525</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>5426</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>47150</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $100,525 but not over $191,950:
                   $17,168.50 plus 24% of the excess over $100,525 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>191950</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>17168.50</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>100525</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $191,950 but not over $243,725:
                   $39,110.50 plus 32% of the excess over $191,950 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>243725</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>39110.50</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>191950</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $243,725 but not over $365,600:
                   $55,678.50 plus 35% of the excess over $243,725 -->
                  <Case>
                    <When>
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>365600</Dollar>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>55678.50</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>243725</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>

                  <!-- Over $365,600:
                   $98,334.75 plus 37% of the excess over $365,600 -->
                  <Case>
                    <When>
                      <GreaterThan>
                        <Left>
                          <Dependency path="/roundedTaxableIncome" />
                        </Left>
                        <Right>
                          <Dollar>365600</Dollar>
                        </Right>
                      </GreaterThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>98334.75</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/roundedTaxableIncome" />
                            </Minuend>
                            <Subtrahends>
                              <Dollar>365600</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/totalTentativeTax">
      <Name>Total tentative tax</Name>
      <Description>Total tentative tax as reported on line 18 of Form 1040.</Description>
      <Export downstreamFacts="true" mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Add>
            <Dependency path="/tentativeTaxFromTaxableIncome" />
            <Dependency module="schedule2" path="/totalAdditionalTaxesOwed" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/nonRefundableCredits">
      <Name>Non-refundable credits</Name>
      <Description>Total amount of non-refundable tax credits as reported on line 21 of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency module="ctcOdc" path="/totalCtcAndOdc" />
            <Dependency module="schedule3" path="/line8OfSchedule3" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/hasNonRefundableCredits">
      <Name>Has non-refundable credits</Name>
      <Description>Whether the taxpayer has non-refundable credits greater than zero</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/nonRefundableCredits" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/maxNonRefundableCredit">
      <Description>The max non refundable credit a TP can get</Description>
      <Derived>
        <LesserOf>
          <Dependency path="/nonRefundableCredits" />
          <!-- The following dependency may not be necessary, we should check this when we finish credits -->
          <Dependency path="/totalTentativeTax" />
        </LesserOf>
      </Derived>
    </Fact>

    <Fact path="/taxLessNonRefundableCredits">
      <Name>Tax less non-refundable credits</Name>
      <Description>Tentative tax minus non-refundable tax credits as reported on line 22 of Form
        1040.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/totalTentativeTax" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/nonRefundableCredits" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/line21OfSchedule2">
      <Name>Line 21 of Schedule 2</Name>
      <Description>Other taxes, including self-employment Line 21 of schedule 2 for line 23 of form
        1040</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>

    <Fact path="/totalTax">
      <Name>Total tax</Name>
      <Description>Total tax as reported on line 24 of Form 1040.</Description>
      <Export downstreamFacts="true" mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <Add>
            <Dependency path="/taxLessNonRefundableCredits" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/totalTaxIsIncomplete">
      <Name>Total tax is incomplete</Name>
      <Description>The total tax calculation is incomplete, so the user cannot file</Description>
      <BlockSubmissionOnTrue />

      <Derived>
        <Not>
          <IsComplete>
            <Dependency path="/totalTax" />
          </IsComplete>
        </Not>
      </Derived>
    </Fact>

    <Fact path="/form1099Withholding">
      <Name>Form 1099 withholding</Name>
      <Description>Federal income tax withheld from wages, as reported on line 25b of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Add>
          <CollectionSum>
            <Dependency module="interest" path="/interestReports/*/taxWithheld" />
          </CollectionSum>
          <CollectionSum>
            <Dependency module="socialSecurity" path="/socialSecurityReports/*/federalTaxWithheld" />
          </CollectionSum>
          <CollectionSum>
            <Dependency module="unemployment" path="/form1099Gs/*/federalTaxWithheld" />
          </CollectionSum>
          <Dependency module="form1099Misc" path="/form1099MiscFederalIncomeTaxWithheld" />
          <Dependency module="form1099Rs" path="/form1099RsFederalIncomeTaxWithheld" />
        </Add>
      </Derived>
    </Fact>

    <Fact path="/otherFormWithholding">
      <Name>Other Form withholding</Name>
      <Description>Federal income tax withheld from wages, as reported on line 25c of Form 1040.</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>

    <Fact path="/totalWithholding">
      <Name>Total withholding</Name>
      <Description>Total withholding as reported on line 25d of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency module="formW2s" path="/formW2Withholding" />
            <Dependency path="/form1099Withholding" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/americanOpportunityCredit">
      <Name>American Opportunity Credit</Name>
      <Description>American opportunity credit from Form 8863, line 8 (line 29 1040)</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>

    <Fact path="/qualifiedForNonrefundableCredit">
      <Name>Qualified for nonrefundable credits</Name>
      <Description>Whether the TP has qualified for any nonrefundable credits.
        This fact drives whether a summarytable is
        displayed in the credit summary page.
        If you change that table, you must also change this fact.
      </Description>
      <Derived>
        <Any>
          <Dependency module="ctcOdc" path="/odcQualified" />
          <Dependency module="ctcOdc" path="/ctcQualified" />
          <Dependency module="cdcc" path="/cdccQualified" />
          <Dependency module="saversCredits" path="/qualifiedForSaverCredit" />
          <Dependency module="elderlyAndDisabled" path="/qualifiedForCreditForElderlyAndDisabled" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/qualifiedForRefundableCredit">
      <Name>Qualified for refundable credits</Name>
      <Description>Whether the TP has qualified for any refundable credit
        This fact drives whether a summarytable is
        displayed in the credit summary page.
        If you change that table, you must also change this fact.
      </Description>

      <Derived>
        <!-- Needs to be updated when we support other credits -->
        <Any>
          <!-- Because ACTC is refundable -->
          <Dependency module="ctcOdc" path="/ctcQualified" />
          <Dependency module="eitc" path="/eitcQualified" />
          <!-- This fact should be true even when you just owe APTC -->
          <Dependency module="ptc" path="/needsToFileForm8962" />
        </Any>
      </Derived>
    </Fact>

    <Fact path="/totalOtherPaymentsRefundableCredits">
      <Name>Total other payments and refundable credits</Name>
      <Description>Total other payments and refundable credits as reported on line 32 of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency module="eitc" path="/earnedIncomeCredit" />
            <Dependency module="ctcOdc" path="/additionalCtc" />
            <Dependency path="/americanOpportunityCredit" />
            <Dependency module="schedule3" path="/otherPaymentsAndRefundableCreditsTotal" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/hasRefundableCredits">
      <Name>Has refundable credits</Name>
      <Description>Whether the taxpayer has refundable credits is greater than zero</Description>
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/totalOtherPaymentsRefundableCredits" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/totalPayments">
      <Name>Total payments</Name>
      <Description>Total payments as reported on line 33 of Form 1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <Add>
            <Dependency path="/totalWithholding" />
            <Dependency module="estimatedPayments" path="/estimatedAndFromLastYear" />
            <Dependency path="/totalOtherPaymentsRefundableCredits" />
          </Add>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/overpayment">
      <Name>Overpayment</Name>
      <Description>The amount that total payments exceed total taxes. Report on line 34 of Form
        1040.</Description>
      <Export mef="true" />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/totalPayments" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/totalTax" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>


    <Fact path="/taxWithCreditsApplied">
      <Name>Tax With Credits Applied</Name>
      <Description>The amount that total payments exceed total taxes. Report on line 34 of Form
        1040.</Description>

      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/totalTax" />
          </Minuend>
          <Subtrahends>
            <Dependency path="/totalOtherPaymentsRefundableCredits" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>


    <Fact path="/finalTaxAmount">
      <Name>Final tax amount</Name>
      <Description>The final tax amount -- either a refund or balance based on the positivity of the
        number</Description>

      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/totalTax" />
          </Minuend>
          <Subtrahends>
            <Dependency path="/totalPayments" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/form8888Attached">
      <Name>Form 8888 Attached</Name>
      <Description>Do you have form 8888 attached?</Description>
      <Derived>
        <False />
      </Derived>
    </Fact>

    <Fact path="/appliedToNextYearEstimated">
      <Name>Amount Applied To Next Year Estimated</Name>
      <Description>Amount of line 34 you want applied to your 2023 estimated tax (line 36 1040)</Description>

      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>

    <Fact path="/dueRefund">
      <Name>Due refund</Name>
      <Description>Is the taxpayer due a refund?</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/overpayment" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/balanceDue">
      <Name>Balance due</Name>
      <Description>The amount that total taxes exceed total payments. Reported on line 37 of Form
        1040.</Description>
      <Export mef="true" />
      <ExportZero />

      <Derived>
        <Round>
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="/totalTax" />
              </Minuend>
              <Subtrahends>
                <Dependency path="/totalPayments" />
              </Subtrahends>
            </Subtract>
            <Dollar>0</Dollar>
          </GreaterOf>
        </Round>
      </Derived>
    </Fact>

    <Fact path="/owesBalance">
      <Name>Owes balance</Name>
      <Description>Does the taxpayer owe taxes?</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/balanceDue" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>

    <Fact path="/zeroBalance">
      <Name>Zero balance</Name>
      <Description>Does the taxpayer have a zero balance due?</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <Equal>
          <Left>
            <Dependency path="/finalTaxAmount" />
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </Equal>
      </Derived>
    </Fact>

    <Fact path="/knockoutHasNoPaymentsOrCredits">
      <Name>Knockout no payments or credits</Name>
      <Description>TP is knocked out because they have no payments or credits</Description>
      <Export downstreamFacts="true" />

      <Derived>
        <All>
          <Not>
            <Dependency module="estimatedPayments" path="/paidEstimatedTaxesOrFromLastYear" />
          </Not>
          <Equal>
            <Left>
              <Dependency module="income" path="/totalIncome" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
          <Equal>
            <Left>
              <Dependency path="/agi" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
          <Equal>
            <Left>
              <Dependency path="/totalTentativeTax" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
          <Equal>
            <Left>
              <Dependency path="/nonRefundableCredits" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
          <Equal>
            <Left>
              <Dependency path="/totalTax" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
          <Equal>
            <Left>
              <Dependency path="/totalPayments" />
            </Left>
            <Right>
              <Dollar>0</Dollar>
            </Right>
          </Equal>
        </All>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
